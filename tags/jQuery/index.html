<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
  <title>jQuery &mdash; Alejandro Beltrán</title>
  <meta name="author" content="Alejandro Beltrán">
  
  <meta name="description" content="Blogging about Front End Development, Software and stuff">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <meta property="og:site_name" content="Alejandro Beltrán">

  
    <meta property="og:image" content="undefined">
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Alejandro Beltrán" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.min.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script>
  var _gaq=[['_setAccount','UA-39910763-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src='//www.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


</head>

<body>
  <header id="header" class="inner">
    <div class="alignleft">
  <h1><a href="/">Alejandro Beltrán</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
  </header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title tag">jQuery</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-08-13T04:01:00.000Z">
          Aug 12th, 2011
        </time>
      
      
  
    <h1 class="title"><a href="/2011/jquery-type/">jQuery.type</a></h1>
  


    </header>
    <div class="entry">
      
        <p>In my last post I wrote about how to detect a JavaScript array, so I thought it
would be a good idea to see how jQuery does it.</p>
<p>Here&#39;s the <code>jQuery.isArray</code> method (in 1.6.2):</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>isArray: Array.isArray || <span class="keyword">function</span>( obj ) {
    <span class="keyword">return</span> jQuery.type(obj) === <span class="string">"array"</span>;
}
</pre></td></tr></table></figure>

<p>It uses the native <code>Array.isArray</code> method if it exists, if not it will find out
the type of whatever is passed in using the <code>jQuery.type</code> method and see if that
equals the string <code>&quot;array&quot;</code>.</p>
<p>But come on, that&#39;s not much of a learning experience not to mention it makes for
a pretty short blog post.</p>
<p>So instead, I looked into the <code>jQuery.type</code> method to see how that works.</p>
<h2><code>jQuery.type</code></h2>
<p>It looks something like this:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="comment">// Save a reference to some core methods</span>
toString = Object.prototype.toString
...
<span class="comment">// [[Class]] -&gt; type pairs</span>
class2type = {};
...
type: <span class="keyword">function</span>( obj ) {
    <span class="keyword">return</span> obj == <span class="literal">null</span> ?
        String( obj ) :
        class2type[ toString.call(obj) ] || <span class="string">"object"</span>;
}
...
<span class="comment">// Populate the class2type map</span>
jQuery.each(
    <span class="string">"Boolean Number String Function Array Date RegExp Object"</span>.split(<span class="string">" "</span>),
    <span class="keyword">function</span>(i, name) {
    class2type[ <span class="string">"[object "</span> + name + <span class="string">"]"</span> ] = name.toLowerCase();
})
</pre></td></tr></table></figure>

<p>(Distant pieces of code are separated with three dots)</p>
<h2>Breaking it down</h2>
<ul>
<li>Line 3 - A reference to the <code>toString</code> method of <code>Object</code>.</li>
<li>Line 6 - An internal object (map) that will contain all types as strings.</li>
<li>Line 15-19 - For each member in the array we&#39;re passing in, we&#39;ll create a
property in the object and set its value to the name of the array member in lowercase.</li>
<li>Line 8-12 - The method will check if the argument passed in is <code>null</code> or <code>undefined</code>,
if so, it will return the string <code>&quot;null&quot;</code> or <code>&quot;undefined&quot;</code> (by calling the <code>String</code>
constructor without the <code>new</code> keyword, which is allowed for some constructors).
If it&#39;s something else, we&#39;ll call the <code>toString</code> method on the argument and look
to see if the <code>class2type</code> object has a value for it, if not, we&#39;ll just return
the string <code>&quot;object&quot;</code>.</li>
</ul>
<p>To give you a better overall picture, here&#39;s how the <code>class2type</code> object would
look after page load:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="keyword">var</span> class2type = {
    <span class="string">"[object Array]"</span>: <span class="string">"array"</span>,
    <span class="string">"[object Boolean]"</span>: <span class="string">"boolean"</span>,
    <span class="string">"[object Date]"</span>: <span class="string">"date"</span>,
    <span class="string">"[object Function]"</span>: <span class="string">"function"</span>,
    <span class="string">"[object Number]"</span>: <span class="string">"number"</span>,
    <span class="string">"[object Object]"</span>: <span class="string">"object"</span>,
    <span class="string">"[object RegExp]"</span>: <span class="string">"regexp"</span>,
    <span class="string">"[object String]"</span>: <span class="string">"string"</span>
};
</pre></td></tr></table></figure>

<h2>Epiphany</h2>
<p>That&#39;s why we call the <code>toString</code> method of <code>Object</code> when we&#39;re looking for the
property name. Remember how this method returns this sort of a <code>&quot;[object Constructor]&quot;</code>
string pattern?</p>
<p>So, if we did <code>jQuery.type(&quot;hello&quot;)</code> we&#39;d actually be doing something like
<code>class2type[&quot;[object String]&quot;]</code>, which would return the corresponding value <code>&quot;string&quot;</code></p>
<p>And that&#39;s how the <code>jQuery.type</code> method works.</p>
<p>It&#39;s not that complicated when you have an &quot;Epiphany&quot; section, huh?</p>
<p>Sources:</p>
<p><a href="http://goo.gl/1T9yK">jQuery.type - jQuery API Documentation</a></p>
<p><a href="http://goo.gl/MW8WI">jQuery 1.6.2 Source Code</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/jquery-type/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-04-28T18:00:00.000Z">
          Apr 28th, 2011
        </time>
      
      
  
    <h1 class="title"><a href="/2011/jquery-trim/">jQuery.trim</a></h1>
  


    </header>
    <div class="entry">
      
        <p>Do you want to know how the trim method works in jQuery? Today is lucky day.</p>
<p>Here&#39;s the code from the jQuery 1.5.2 source, I separated distant lines of code
with three dots:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre>...
<span class="comment">// Check if a string has a non-whitespace character in it</span>
rnotwhite = <span class="regexp">/\S/</span>,

<span class="comment">// Used for trimming whitespace</span>
trimLeft = <span class="regexp">/^\s+/</span>,
trimRight = <span class="regexp">/\s+$/</span>,
...
<span class="comment">// Save a reference to some core methods</span>
...
trim = String.prototype.trim,
...
<span class="comment">// Use native String.trim function wherever possible</span>
trim: trim ?
    <span class="keyword">function</span>( text ) {
        <span class="keyword">return</span> text == <span class="literal">null</span> ?
            <span class="string">""</span> :
            trim.call( text );
    } :

    <span class="comment">// Otherwise use our own trimming functionality</span>
    <span class="keyword">function</span>( text ) {
        <span class="keyword">return</span> text == <span class="literal">null</span> ?
            <span class="string">""</span> :
            text.toString().replace( trimLeft, <span class="string">""</span> ).replace( trimRight, <span class="string">""</span> );
    },
...
<span class="comment">// IE doesn't match non-breaking spaces with \s</span>
<span class="keyword">if</span> ( rnotwhite.test( <span class="string">"\xA0"</span> ) ) {
    trimLeft = <span class="regexp">/^[\s\xA0]+/</span>;
    trimRight = <span class="regexp">/[\s\xA0]+$/</span>;
}
...
</pre></td></tr></table></figure>

<p>Line 14 is where the ternary action to determine how <code>jQuery.trim</code> will behave
begins, all the way through line 26. Another way to look at it is this:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>trim: trim ?
    <span class="keyword">function</span>( text ) {
        <span class="comment">// native trimming</span>
    } :
    <span class="keyword">function</span>( text ) {
        <span class="comment">// jQuery trimming</span>
    },
</pre></td></tr></table></figure>

<p>You might find <code>trim: trim</code> hard to understand, but not when you look at the
<code>trim</code> variable in line 11. Notice how jQuery stores an internal reference to
the native <code>trim</code> method of strings. So, if we have native support for trimming,
i.e. checking for truthy value in the <code>trim</code> variable, we go ahead and do it
that way but not before checking for <code>null</code> or <code>undefined</code>.</p>
<p>If the browser doesn&#39;t have support, we&#39;ll check if the passed string is not
<code>null</code> or <code>undefined</code>, if it is, we&#39;ll return a blank string (just like in the
first case), otherwise we&#39;ll trim it. Let&#39;s see how.</p>
<p>We&#39;re calling the <code>toString</code> method on the passed string to, and this is a total
guess, make sure we have a string to work with before attempting any operation.</p>
<p>Then we&#39;ll trim the left side of the string and after that the right side. The
regular expressions for those (in lines 6 &amp; 7) match, pretty much, every type of
space you wouldn&#39;t want in your string. So, we make sure that the passed string
doesn&#39;t have those, and if it does, we get rid of them by replacing them with a
blank string.</p>
<p>We&#39;re just missing lines 2-3 and 28-32. <code>rnotwhite</code> matches a single character
other than white space and lines 28-32 check if we should be checking for
non-breaking spaces (<code>A0</code> in hexadecimal) in our trimming, mostly because of IE
like the comment says. If so, we need to redefine our <code>trimLeft</code> and <code>trimRight</code>
to include matching the non-breaking space character.</p>
<p>Sources:</p>
<p><a href="http://goo.gl/ycx2j">jQuery 1.5.2 source code</a></p>
<p><a href="http://goo.gl/kD5JA">jQuery API - jQuery.trim</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/jquery-trim/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-04-21T21:30:00.000Z">
          Apr 21st, 2011
        </time>
      
      
  
    <h1 class="title"><a href="/2011/jquery-parsejson/">jQuery.parseJSON</a></h1>
  


    </header>
    <div class="entry">
      
        <p>The other day I was re-watching (haha, learning through repetition) &quot;11 More
Things I Learned from the jQuery Source&quot; and this time I was quite amazed when
Paul Irish talked about <code>parseJSON</code>. And the reason was the way jQuery makes the
JSON object, it&#39;s clever, it&#39;s very clever.</p>
<p>Let me show you. Here&#39;s jQuery&#39;s 1.5.2 <code>parseJSON</code> method:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre>parseJSON: <span class="keyword">function</span>( data ) {
    <span class="keyword">if</span> ( <span class="keyword">typeof</span> data !== <span class="string">"string"</span> || !data ) {
        <span class="keyword">return</span> <span class="literal">null</span>;
    }

    <span class="comment">// Make sure leading/trailing whitespace is removed (IE can't handle it)</span>
    data = jQuery.trim( data );

    <span class="comment">// Make sure the incoming data is actual JSON</span>
    <span class="comment">// Logic borrowed from http://json.org/json2.js</span>
    <span class="keyword">if</span> ( rvalidchars.test(data.replace(rvalidescape, <span class="string">"@"</span>)
        .replace(rvalidtokens, <span class="string">"]"</span>)
        .replace(rvalidbraces, <span class="string">""</span>)) ) {

        <span class="comment">// Try to use the native JSON parser first</span>
        <span class="keyword">return</span> window.JSON && window.JSON.parse ?
            window.JSON.parse( data ) :
            (<span class="keyword">new</span> Function(<span class="string">"return "</span> + data))();

    } <span class="keyword">else</span> {
        jQuery.error( <span class="string">"Invalid JSON: "</span> + data );
    }
},
</pre></td></tr></table></figure>

<p>Let&#39;s dissect that:</p>
<ul>
<li>Lines 2-4 are just checking you pass a string and its not empty.</li>
<li>Line 7 explains itself.</li>
<li>Lines 11-13 is a regular expression evaluation to make sure we have valid JSON.</li>
</ul>
<p>The interesting part, in this case, is the return statement:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">return</span> window.JSON && window.JSON.parse ?
    window.JSON.parse( data ) :
    (<span class="keyword">new</span> Function(<span class="string">"return "</span> + data))();
</pre></td></tr></table></figure>

<p>If the browser has native JSON support, use that. If not, and this is the
interesting part, we&#39;ll do <code>(new Function(&quot;return &quot; + data))()</code>.</p>
<p>But what does that mean? I&#39;m glad you asked.</p>
<ul>
<li>We&#39;re calling the <code>Function</code> constructor, which will return a <code>Function</code>
object (function reference) and immediately invoke it.</li>
<li>The <code>Function</code> constructor takes an &quot;n&quot; number of arguments that will become
the function&#39;s parameters, being the last one the body of the function. We&#39;re
passing only one parameter, meaning <code>&quot;return &quot; + data</code> will become the
function&#39;s body.</li>
<li>What does the constructed function do then? Considering <code>data</code> is a JSON
string it becomes rather obvious now. It returns a JavaScript object. See? I
told you it was clever, no need for <code>eval</code> this way.</li>
</ul>
<p>Sources:</p>
<p><a href="http://goo.gl/NiNm6">11 More Things I Learned From The jQuery Source</a></p>
<p><a href="http://goo.gl/PfwKh">Function - MDN</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/jquery-parsejson/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:alebelcor.github.io">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/CSS/">CSS</a><small>1</small></li>
  
    <li><a href="/tags/DOM/">DOM</a><small>4</small></li>
  
    <li><a href="/tags/HTML5/">HTML5</a><small>1</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>1</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>12</small></li>
  
    <li><a href="/tags/Tools/">Tools</a><small>2</small></li>
  
    <li><a href="/tags/jQuery/">jQuery</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget twitter">
  <h3 class="title">Tweets</h3>
  <ul id="tweets"></ul>
</div>

<script type="text/javascript">
var twitter_stream = ['alebelcor', 5, false];
var moment_js_path = '/js/moment.min.js';
</script>
<script src="/js/twitter.js"></script>


</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner">
    <div class="alignleft">
  
  &copy; 2013 Alejandro Beltrán (&#10061;&#7461;&#10061;&#651;)
  
</div>
<div class="clearfix"></div>

  </footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>





</body>
</html>
