<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8>
  <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
  
  <title>An Introduction to Mocha &mdash; Alejandro Beltrán</title>
  <meta name=author content="Alejandro Beltrán">
  
  <meta name=description content="Blogging about Front End Development, Software and stuff">
  
  
  <meta name=viewport content="width=device-width, initial-scale=1">
  <meta property=og:title content="An Introduction to Mocha">
  <meta property=og:site_name content="Alejandro Beltrán">
  
    <meta property=og:image content=undefined>
  
  <link href="/favicon.png" rel=icon>
  <link rel=alternate href="/atom.xml" title="Alejandro Beltrán" type="application/atom+xml">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel=stylesheet type="text/css">
  <link rel=stylesheet href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.min.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script>
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
  function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
  e=o.createElement(i);r=o.getElementsByTagName(i)[0];
  e.src='//www.google-analytics.com/analytics.js';
  r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-39910763-1');ga('send','pageview');
</script>


</head>

<body>
  <header id=header class=inner>
    <div class=alignleft>
  <h1><a href="/">Alejandro Beltrán</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id=main-nav class=alignright>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class=clearfix></div>
</nav>
<div class=clearfix></div>
  </header>
  <div id=content class=inner>
    <div id=main-col class=alignleft><div id=wrapper><article class=post>
  
  <div class=post-content>
    <header>
      
        <div class=icon></div>
        <time datetime=2013-06-10T00:50:40.000Z>
          Jun 9th, 2013
        </time>
      
      
  
    <h1 class=title><a href="/2013/an-introduction-to-mocha/">An Introduction to Mocha</a></h1>
  

    </header>
    <div class=entry>
      
        
          
  <script>
    var addthis_config = {
      'ui_language'          : 'en',
    
      'data_ga_property'     : 'UA-39910763-1',
    
      'data_track_addressbar': false,
      'data_track_clickback' : true
    };
  </script>
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class=addthis_button_facebook_like fb:like:layout=button_count></a>
    
    
      <a class=addthis_button_tweet tw:via=alebelcor></a>
    
    
      <a class=addthis_button_google_plusone g:plusone:size=medium></a>
    
    
  </div>
  <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51a2a190502ebfe9"></script>


        
        <h2>What is Mocha?</h2>
<p><a href="http://visionmedia.github.io/mocha/">Mocha</a> is a feature-rich JavaScript
test framework running on node and the browser, making asynchronous
testing simple and fun.</p>
<p>If you&#39;re interested in writing tests for your JavaScript code, Mocha is
a good way to start.</p>
<a name=more></a>

<h2>Advantages</h2>
<ul>
<li>Runs on both Node.js and the browser.</li>
<li>Allows for regular and async testing.</li>
<li>Allows use of any assertion library you want.</li>
<li>Tests can be written in a BDD, TDD or other styles.</li>
<li>Has a variety of test results reporters.</li>
<li>Built-in file watching support.</li>
<li>and <a href="http://visionmedia.github.io/mocha/#features">more</a>.</li>
</ul>
<h2>Testing with Mocha</h2>
<h3>Installation</h3>
<p>First, you need to have Node.js installed (and npm).</p>
<p>To install:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
</pre></td><td class=code><pre>npm install -g mocha
</pre></td></tr></table></figure>

<p>This installs Mocha globally so that you can use the command everywhere.</p>
<h3>How to use</h3>
<figure class="highlight lang-javascript"><table><tr><td class=gutter><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class=code><pre><span class=keyword>var</span> assert = require(<span class=string>'assert'</span>);

describe(<span class=string>'String'</span>, <span class=function><span class=keyword>function</span> <span class=params>()</span> {</span>
    describe(<span class=string>'#indexOf'</span>, <span class=function><span class=keyword>function</span> <span class=params>()</span> {</span>
        it(<span class=string>'should return -1 when the substring is not present'</span>, <span class=function><span class=keyword>function</span> <span class=params>()</span> {</span>
            <span class=keyword>var</span> myString = <span class=string>'test'</span>;

            assert.equal(-<span class=number>1</span>, myString.indexOf(<span class=string>'x'</span>));
            assert.equal(-<span class=number>1</span>, myString.indexOf(<span class=string>'y'</span>));
        });
    });
});
</pre></td></tr></table></figure>

<p>Let&#39;s save the above code as a <code>test.js</code> file. We&#39;d run the test like this:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
</pre></td><td class=code><pre>mocha test.js
</pre></td></tr></table></figure>

<p>By default, if you don&#39;t specify a file or folder, Mocha will run all tests in
the <code>test</code> folder where you&#39;re running the command.</p>
<p>Let&#39;s leverage that and move the file to a <code>test</code> folder. Run:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
</pre></td><td class=code><pre>mocha
</pre></td></tr></table></figure>

<p>And the same output should show up.</p>
<h3>Recursive</h3>
<p>If you have a folder structure with lots of files and  in your <code>test</code> folder you
can run mocha with the <code>--recursive</code> option:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
</pre></td><td class=code><pre>mocha --recursive
</pre></td></tr></table></figure>

<p>This will find and run every test file on every folder.</p>
<h3>Reporters</h3>
<p>Now, our output, although colored, looks kind of weak:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
2
3
4
</pre></td><td class=code><pre>
  .

  ✓ 1 test complete (5 ms)
</pre></td></tr></table></figure>

<p>Luckily, Mocha provides several
<a href="http://visionmedia.github.io/mocha/#reporters">reporters</a> for us to choose how
we&#39;d like our test results output to look like.</p>
<p>My preference is to use the <code>spec</code> reporter. We can use it like so:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
2
3
</pre></td><td class=code><pre>mocha -R spec
<span class=comment># or</span>
mocha --reporter spec
</pre></td></tr></table></figure>

<p>To which the output now would be:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
2
3
4
5
6
</pre></td><td class=code><pre>  String
    <span class=comment>#indexOf</span>
      ✓ should <span class=keyword>return</span> -1 when the substring is not present


  1 test complete (7 ms)
</pre></td></tr></table></figure>

<h3><code>mocha.opts</code></h3>
<p>We can save an options file called <code>mocha.opts</code> where we can specify
command-line options to pass to Mocha. Say, every time we run our our tests
we&#39;d like it to be recursive, use the spec reporter and exit on the first
failed test:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
2
3
</pre></td><td class=code><pre>---recursive
---reporter spec
---bail
</pre></td></tr></table></figure>


<h3>Assertions</h3>
<p>Mocha doesn&#39;t have a built-in assertion system. In fact, if you hadn&#39;t noticed,
the test example is using Node.js&#39; <code>assert</code>
<a href="http://nodejs.org/api/assert.html">module</a> because, again, Mocha doesn&#39;t have
one.</p>
<p>This can be thought of as both good and bad, but let&#39;s try to keep an open mind.</p>
<p>With Mocha we can use any assertion library we want to make our tests.</p>
<p>Here are some options listed on the website:</p>
<ul>
<li><a href="http://github.com/visionmedia/should.js">should.js</a></li>
<li><a href="https://github.com/LearnBoost/expect.js">expect.js</a></li>
<li><a href="http://chaijs.com/">chai</a></li>
<li><a href="https://github.com/visionmedia/better-assert">better-assert</a></li>
</ul>
<p>The one I have experimented with is chai, specifically,
<a href="http://chaijs.com/guide/styles/#expect">chai&#39;s expect</a> assertion.</p>
<p>How would we rewrite the example using chai&#39;s expect? Let&#39;s first install it:</p>
<figure class="highlight lang-bash"><table><tr><td class=gutter><pre>1
</pre></td><td class=code><pre>npm install chai
</pre></td></tr></table></figure>

<p>We&#39;d have to require chai&#39;s <code>expect</code>.</p>
<figure class="highlight lang-javascript"><table><tr><td class=gutter><pre>1
</pre></td><td class=code><pre><span class=keyword>var</span> expect = require(<span class=string>'chai'</span>).expect;
</pre></td></tr></table></figure>

<p>And instead of saying <code>assert.equal</code> we would do something like <code>expect</code> this
value to be equal to this other value:</p>
<figure class="highlight lang-javascript"><table><tr><td class=gutter><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class=code><pre><span class=keyword>var</span> expect = require(<span class=string>'chai'</span>).expect;

describe(<span class=string>'String'</span>, <span class=function><span class=keyword>function</span> <span class=params>()</span> {</span>
    describe(<span class=string>'#indexOf'</span>, <span class=function><span class=keyword>function</span> <span class=params>()</span> {</span>
        it(<span class=string>'should return -1 when the substring is not present'</span>, <span class=function><span class=keyword>function</span> <span class=params>()</span> {</span>
            <span class=keyword>var</span> myString = <span class=string>'test'</span>;

            expect(myString.indexOf(<span class=string>'x'</span>)).to.equal(-<span class=number>1</span>);
            expect(myString.indexOf(<span class=string>'y'</span>)).to.equal(-<span class=number>1</span>);
        });
    });
});
</pre></td></tr></table></figure>

<p>The difference is subtle, but significant in readability. If you&#39;re not very
fond of this style, chai has two other styles and if you don&#39;t like those, try
another library.</p>
<h2>Conclusion</h2>
<p>I like it, ha. I like it because it has so many options, because it has useful
things already baked in, because it&#39;s easy, flexible, pluggable and
configurable.</p>
<p>Go take a look at the docs, I didn&#39;t write about a lot of awesome Mocha stuff.</p>
<p>Sources:</p>
<ul>
<li><a href="http://visionmedia.github.io/mocha/">Mocha</a></li>
<li><a href="http://chaijs.com/">Chai</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
  
  <div class=tags>
    <a href="/tags/JavaScript/">JavaScript</a>, <a href="/tags/Testing/">Testing</a>, <a href="/tags/Tools/">Tools</a>
  </div>

      
      <div class=clearfix></div>
    </footer>
  </div>
</article>


<section id=comment>
  <h1 class=title>Comments</h1>
  <div id=disqus_thread>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div></div>
    <aside id=sidebar class=alignright>
  <div class=search>
  <form action="//google.com/search" accept-charset=utf-8>
    <input type=search name=q results=0 placeholder=Search>
    <input type=hidden name=q value=site:alebelcor.github.io>
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class=title>Tags</h3>
  <ul class=entry>
  
    <li><a href="/tags/CSS/">CSS</a><small>2</small></li>
  
    <li><a href="/tags/DOM/">DOM</a><small>4</small></li>
  
    <li><a href="/tags/HTML5/">HTML5</a><small>1</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>1</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>13</small></li>
  
    <li><a href="/tags/Testing/">Testing</a><small>1</small></li>
  
    <li><a href="/tags/Tools/">Tools</a><small>4</small></li>
  
    <li><a href="/tags/jQuery/">jQuery</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget twitter">
  <h3 class=title>Tweets</h3>
  <ul id=tweets></ul>
</div>

<script>
    var twitter_stream = ['alebelcor', 5, false];
    var moment_js_path = '/js/moment.min.js';
</script>
<script src="/js/twitter.js"></script>

</aside>
    <div class=clearfix></div>
  </div>
  <footer id=footer class=inner>
    <div class=alignleft>
  
  &copy; 2013 Alejandro Beltrán (&#10061;&#7461;&#10061;&#651;)
  
</div>
<div class=clearfix></div>
  </footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script>
var disqus_shortname = 'alebelcor-github-io';

(function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



</body>
</html>